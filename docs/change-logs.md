# 升级日志

## 2024-9-3 Server@2.1.1 Client@2.0.0

### Server 
- 💄 优化 一些配置错误也会向客户端下发通知，在客户端错误捕捉中可以直接拿到信息 
- 🐞 修复 plugins 不配置的情况下会直接报错  
- 🐞 修复 自定义指令执行后会被唤醒两次 

### Client 

本次未有任何更新

## 2024-9-1 Server@2.0.0 Client@2.0.0  

🔥🔥🔥 `ESP-AI` 生态中新增一名新成员：`ESP-AI 开发者平台`

🔥🔥🔥 网址：`https://dev.espai.fun`

🔥🔥🔥 开发者平台中功能：提供免费服务、可视化配置服务、各种在线工具...

### Server 

- 🔥 新增 错误捕捉到后会回馈到客户端，客户端可以参照错误对照表进行相关错误提示。
- 🔥 新增 内置火山引擎 `LLM` (可接入豆包等) 
- 🔥 新增 服务下的每个用户都可以拥有一套独立的配置  
- 🔥 优化 `TTS` 任务机制，增量字数转换，在解决TTS服务付费焦虑的同时让对话更加连贯快速。
- 🔥 优化 音频播放中可以读取到 llm 对话历史，并且支持控制开始时间等等
- 🆕 新增 `connected_reply` 配置，用于更改服务连接后的提示语 
- 🆕 新增 服务启动时输出所有配置项，方便用户清楚的知道用的什么服务
- 🆕 新增 异常捕捉处理，防止未使用 `pm2` 等方式运行时服务报错直接挂掉。
- 🤔 调整 删除 `api_key` 配置，使用 `iat_config、llm_config、tts_config` 代替。(因为全部放到`api_key`太过于迷惑) 
- 🤔 调整 修改服务默认端口为 `8088`（因为`8080`冲突概率极大）
- 🤔 调整 其他部分配置，详情见文档
- 💄 优化 更换更好的开始会话前提示音
- 🐞 修复 断句会存在和上一句出现重复的问题  
  
##### Install

```bash
npm i esp-ai@2.0.0
```
docker Install
```bash
docker exec -it esp-ai-server npm i esp-ai@2.0.0
# 安装完后记得重启： docker exec -it esp-ai-server pm2 reload all
```

### Client 

- 🔥 新增 支持搭配 `ESP-AI 开发者平台`连接，实现超简单个人与企业的AI对话方案解决. 只需在配网页面填入一个 `api_key` 即可
- 🔥 新增 `.onError` 统一错误捕捉回调，开发者可根据错误码来决定怎么提示用户
- 🔥 新增 `.onConnectedWifiCb` 用于监听设备连接 `wifi` 成功，形参中可以直接拿到 `ip` 地址
- 🔥 新增 配网设置页面，并且页面支持自定义，除了` wifi `信息外还提供额外的扩展字段用于保存自己的业务数据
- 🔥 新增 对话过程可打断，通过呼喊`小明同学`重新开始会话 
- 🔥 新增 新增多种内置唤醒方案：`引脚高低电平唤醒`、`天问模块唤醒`、`串口字符串唤醒`，直接配置就可使用。
- 🔥 新增 `.onNetStatus` 统一状态回调，设备连接wifi、连接服务等状态都可以在回调中统一获取
- 🔥 新增 `.onAPInfo` 设备打开热点后回调，在这个回调中你应该提示用户打开配网页，回调形参中可以拿到热点所有信息。 
- 🆕 新增 `setWifiConfig` 用于手动设置`wifi`信息 
- 🆕 新增 每个设备初始化时都会生成一个 UUID，在需要时可以拿到。 相当于`sn`码
- 🤔 调整 配置顺序调整，不必要的参数放后面可留空不配置  
<!-- - 🤔 调整 唤醒方案优化，精度提升至 60%（后续将继续优化） -->
- 🤔 调整 内置语音唤醒方案暂时推迟到未来的3个左右的版本发布（由于精度优化过于耗费时间，所以需要单独在做一次升级）。
- 💄 优化 美化控制台输出
- 💄 优化 重构客户端代码
- 🐞 修复 某些环境中上传代码会报错 `LED_BUILTIN` 未定义 
- 🐞 修复 一些其他问题...

##### Install
请到仓库发布页面自行下载最新版客户端：https://github.com/wangzongming/esp-ai/releases   

需要下载的文件名字 `esp-ai-xxx.zip`



## 2024-8-1 Server@1.18.7 Client@1.4.2
### Server 

- 🆕 新增 网络延时输出  
- 🤔 调整 服务启动时输出全部的本地IP地址
- 💄 优化 控制台部分文字颜色调整
- 🐞 修复 在音频数据过大时(如播放歌曲时)，服务会异常断开连接  

##### Install

```bash
npm i esp-ai@1.18.7
```
docker Install
```bash
docker exec -it esp-ai-server  npm i esp-ai@1.18.7
```

### Client 

- 🆕 新增 网络延时输出
- 🐞 修复 在音频数据过大时(如播放歌曲时)，服务会异常断开连接  

##### Install
<a href="https://github.com/user-attachments/files/16454824/esp-ai-1.4.2.zip">esp-ai Arduino依赖库 点击下载</a>


## 2024-7-30 Server@1.15.6 Client@1.3.1 

#### Server 

- 🆕 新增 鉴权配置，用户每次请求接口时都可进行一次鉴权

##### Install

```
npm i esp-ai@1.15.6
```

#### Client 

- 🆕 新增 连接服务时可传递参数，用于服务端鉴权等。

##### Install
<a href="https://github.com/user-attachments/files/16422116/esp-ai-1.3.1.zip">esp-ai Arduino依赖库 点击下载</a>


## 2024-7-23 Server@1.14.5 Client@1.2.1 

#### Server 

- 🐞 修复 播放 `http` 地址放入音乐会报错 

##### Install

```
npm i esp-ai@1.14.5
```

#### Client 

- 🐞 修复 一些其他问题

##### Install
<a href="https://github.com/user-attachments/files/16347295/esp-ai-1.2.1.zip">esp-ai Arduino依赖库 点击下载</a>


## 2024-7-22 Server@1.14.4 Client@1.2.0 

#### Server

- 🐞 修复 讯飞llm服务返回报错后框架未将错误输出

##### Install


```
npm i esp-ai@1.14.4
```

#### Client

- 💄 优化 稳定性提示
 
##### Install
<a href="https://github.com/user-attachments/files/16323083/esp-ai-1.1.0.zip">esp-ai Arduino依赖库 点击下载</a>


## 2024-07-21 

#### 服务端 v1.14.3

- 🆕 新增 音乐播放功能  
- 🐞 修复 第一次唤醒后再也唤醒不了



#### 客户端 v1.2.0

- 💄 优化 稳定性提示
- 
## 2024-07-20 

#### 服务端 v1.13.2

- 🆕 新增 语音识别完毕后增加回调  
- 🆕 新增 vad_eos 语音识别静默时间配置  
- 🤔 调整 重构 TTS 插件的形参，分离插件中任何与框架耦合的概念(极大降低插件封装难度) 
- 🤔 调整 重构 IAT 插件的形参，分离插件中任何与框架耦合的概念(极大降低插件封装难度) 
- 🤔 调整 重构 LLM 插件的形参，分离插件中任何与框架耦合的概念(极大降低插件封装难度)  
- 🤔 调整 延长听不见用户说话的静默时间 
- 💄 优化 部分配置在错误情况下增加提示
- 🐞 修复 有时候第一次唤醒后再也唤醒不了 
- 🐞 修复 对话时可能会混乱 

#### 客户端 v1.0.0  

- 🤔 调整 `esp_ai.onEvent()` 中的两个形参类型为 `String` 类型，更加方便使用 (如使用 `==` 直接判断命令)
- 💄 优化 语音唤醒准确度 



## 2024-07-13 

- 🆕 新增 插件开发功能，支持为服务端开发自定义的插件
- 🆕 新增 增加客户端扬声器采样率配置
- 🆕 新增 海豚配音插件 `TTS`，支持众多音色，详情见：https://www.ttson.cn/
- 💄 优化 音频流拆分，减少客户端喇叭杂音 
- 💄 优化 对话过程的流畅性  
- 💄 优化 小明同学聆听前会发出提示音  


## 2024-07-09
#### v1.0.0  

- ✨ 重构 客户端代码，改为头文件形式。
- 🆕 新增 火山引擎 `TTS` 接入 
- 🐞 修复 调用 `讯飞LLM` 非3.5版本时报错 
- 🐞 修复 服务端部分bug 


## 2024-07-01
#### v0.0.1
- 🆕 新增 测试版发布啦  
